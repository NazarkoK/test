<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>test_server.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#include &lt;gtest/gtest.h&gt;
#include "SerialPort.h"
#include &lt;string&gt;
#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include &lt;nlohmann/json.hpp&gt;
#include &lt;sstream&gt;

using namespace std;
using json = nlohmann::json;

<span style = "background-color:#dfd">string portName; ///&lt; Íàçâà ñåð³éíîãî ïîðòó äëÿ âèêîðèñòàííÿ.</span>
int portSpeed; ///&lt; Øâèäê³ñòü ïîðòó (Baud rate).

/**
 * @brief Íîðìàë³çóº ñèìâîëè íîâîãî ðÿäêà ó ðÿäêó.
 */
<span style = "background-color:#dfd">string normalizeNewlines(const string&amp; str) {
    string normalized = str;
    replace(normalized.begin(), normalized.end(), '\r', '\n');
    return normalized;
}</span>

/**
 * @brief Òåñòîâèé ô³êñ äëÿ òåñòóâàííÿ ôóíêö³îíàëüíîñò³ ñåð³éíîãî ïîðòó.
 */
class SerialPortTest : public ::testing::Test {
protected:
    SerialCommunication serial; ///&lt; Îá'ºêò äëÿ òåñòóâàííÿ ñåð³éíîãî ïîðòó.

<span style = "background-color:#dfd">    void SetUp() override {}</span>

<span style = "background-color:#dfd">    void TearDown() override {
        serial.disconnect();
    }</span>
};

<span style = "background-color:#dfd">TEST_F(SerialPortTest, TestDrawBoard) {
    string boardState = "X O   O X   O";  // Çàïîâíåíå ïîëå ç ïîðîæí³ìè êë³òèíêàìè
    stringstream output;
    streambuf* orig_buf = cout.rdbuf(output.rdbuf()); // Ï³äêëþ÷àºìî òåñòîâèé ïîò³ê âèâåäåííÿ.</span>

<span style = "background-color:#dfd">    serial.drawBoard(boardState); // Âèêëèêàºìî ôóíêö³þ äëÿ ìàëþâàííÿ äîøêè.</span>

<span style = "background-color:#dfd">    string expectedOutput = "-------------\n| X |   | O | \n-------------\n|   |   |   | \n-------------\n| O |   | X | \n-------------\n";
    EXPECT_EQ(normalizeNewlines(output.str()), normalizeNewlines(expectedOutput)); // Ïåðåâ³ðÿºìî êîðåêòí³ñòü âèâåäåííÿ.</span>

<span style = "background-color:#dfd">    cout.rdbuf(orig_buf);  // Â³äíîâëþºìî îðèã³íàëüíèé ïîò³ê.
}</span>



/**
 * @brief Òåñòóº ôóíêö³þ loadConfig.
 *
 * Öåé òåñò ïåðåâ³ðÿº ïðàâèëüíå çàâàíòàæåííÿ íàëàøòóâàíü ç JSON ôàéëó.
 */
<span style = "background-color:#dfd">TEST_F(SerialPortTest, TestLoadConfig) {
    stringstream configStream;
    configStream &lt;&lt; R"({</span>
        "Connection": {
            "port": "COM3",
            "baudRate": 9600
        }
    })";
<span style = "background-color:#dfd">    istringstream input(configStream.str());</span>

<span style = "background-color:#dfd">    json j;
    input &gt;&gt; j;</span>

    // Òåñòóºìî, ÷è íàëàøòóâàííÿ çàâàíòàæóþòüñÿ ïðàâèëüíî.
<span style = "background-color:#dfd">    EXPECT_EQ(j["Connection"]["port"].get&lt;string&gt;(), "COM3");
    EXPECT_EQ(j["Connection"]["baudRate"].get&lt;int&gt;(), 9600);
}</span>

/**
 * @brief Òåñòóº ç'ºäíàííÿ ÷åðåç ñåð³éíèé ïîðò.
 */
<span style = "background-color:#dfd">TEST_F(SerialPortTest, TestConnection) {
    bool isConnected = serial.connect(portName, portSpeed);
    EXPECT_TRUE(isConnected);  ///&lt; Ïåðåâ³ðÿºìî, ÷è ç'ºäíàííÿ óñï³øíå.
}</span>

/**
 * @brief Òåñòóº íàäñèëàííÿ êîìàíäè "StartGame".
 */
<span style = "background-color:#dfd">TEST_F(SerialPortTest, TestStartGame) {
    bool isConnected = serial.connect(portName, portSpeed);
    EXPECT_TRUE(isConnected);</span>

<span style = "background-color:#dfd">    string command = "StartGame";
    string response = serial.sendMessage(command);</span>

<span style = "background-color:#dfd">    string expectedResponse = "GameStarted";
    EXPECT_EQ(normalizeNewlines(response.substr(0, expectedResponse.length())), normalizeNewlines(expectedResponse));
}</span>

/**
 * @brief Òåñòóº íàäñèëàííÿ êîìàíäè "SetMode 1".
 */
<span style = "background-color:#dfd">TEST_F(SerialPortTest, TestSetGameMode) {
    bool isConnected = serial.connect(portName, portSpeed);
    EXPECT_TRUE(isConnected);</span>

<span style = "background-color:#dfd">    string command = "SetMode 1";
    string response = serial.sendMessage(command);</span>

<span style = "background-color:#dfd">    string expectedResponse = "Mode set to 1";
    EXPECT_EQ(normalizeNewlines(response.substr(0, expectedResponse.length())), normalizeNewlines(expectedResponse));
}</span>

/**
 * @brief Òåñòóº íàäñèëàííÿ íåâàë³äíî¿ êîìàíäè "SetMode 4".
 */
<span style = "background-color:#dfd">TEST_F(SerialPortTest, TestInvalidGameMode) {
    bool isConnected = serial.connect(portName, portSpeed);
    EXPECT_TRUE(isConnected);</span>

<span style = "background-color:#dfd">    string command = "SetMode 4";
    string response = serial.sendMessage(command);
    string expectedResponse = "InvailChoice";
    EXPECT_EQ(normalizeNewlines(response.substr(0, expectedResponse.length())), normalizeNewlines(expectedResponse));
}</span>

/**
 * @brief Ãîëîâíà ôóíêö³ÿ äëÿ çàïóñêó òåñò³â.
 */
<span style = "background-color:#dfd">int main(int argc, char** argv) {
    portName = "COM6"; ///&lt; Çà çàìîâ÷óâàííÿì COM ïîðò.
    portSpeed = 9600; ///&lt; Çà çàìîâ÷óâàííÿì øâèäê³ñòü ïîðòó.</span>

<span style = "background-color:#dfd">    if (argc &gt; 1) {
        portName = argv[1];
        cout &lt;&lt; "Using COM port: " &lt;&lt; portName &lt;&lt; endl;</span>
    }

<span style = "background-color:#dfd">    if (argc &gt; 2) {
        portSpeed = stoi(argv[2]);
        cout &lt;&lt; "Using baud rate: " &lt;&lt; portSpeed &lt;&lt; endl;</span>
    }

<span style = "background-color:#dfd">    ::testing::InitGoogleTest(&amp;argc, argv);
    return RUN_ALL_TESTS(); ///&lt; Çàïóñêàº âñ³ òåñòè.
}</span></pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>