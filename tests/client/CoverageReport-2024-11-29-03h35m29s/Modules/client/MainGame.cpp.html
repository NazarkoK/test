<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>MainGame.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#include "SerialPort.h"
#include &lt;gmock/gmock.h&gt;
#include &lt;gtest/gtest.h&gt;
#include &lt;windows.h&gt;

// Ìîê-ôóíêö³¿ äëÿ SetCommState ³ SetCommTimeouts
class MockSerialPort {
public:
<span style = "background-color:#dfd">    MOCK_METHOD(bool, SetCommState, (HANDLE hSerial, DCB* dcb), ());
    MOCK_METHOD(bool, SetCommTimeouts, (HANDLE hSerial, COMMTIMEOUTS* timeouts), ());</span>
};

// Òåñòîâèé êëàñ, ùî âèêîðèñòîâóº ìîê
class SerialCommunicationTest : public ::testing::Test {
protected:
    MockSerialPort mockSerial;
    SerialCommunication serial;

    // Ïðîêñ³ äëÿ ï³äêëþ÷åííÿ äî ïîðòó, âèêîðèñòîâóþ÷è ìîê
<span style = "background-color:#dfd">    bool connectWithMock(const std::string&amp; portName, int baudRate) {
        DCB dcb = { 0 };
        dcb.DCBlength = sizeof(dcb);
        dcb.BaudRate = baudRate;
        dcb.ByteSize = 8;
        dcb.StopBits = ONESTOPBIT;
        dcb.Parity = NOPARITY;</span>

        // Ìîêàºìî SetCommState
<span style = "background-color:#dfd">        EXPECT_CALL(mockSerial, SetCommState(testing::_, testing::_))</span>
            .WillOnce(testing::Return(true));

<span style = "background-color:#dfd">        COMMTIMEOUTS timeouts = { 0 };
        timeouts.ReadIntervalTimeout = 50;
        timeouts.ReadTotalTimeoutConstant = 50;
        timeouts.ReadTotalTimeoutMultiplier = 10;
        timeouts.WriteTotalTimeoutConstant = 50;
        timeouts.WriteTotalTimeoutMultiplier = 10;</span>

        // Ìîêàºìî SetCommTimeouts
<span style = "background-color:#dfd">        EXPECT_CALL(mockSerial, SetCommTimeouts(testing::_, testing::_))</span>
            .WillOnce(testing::Return(true));

<span style = "background-color:#dfd">        return mockSerial.SetCommState(INVALID_HANDLE_VALUE, &amp;dcb) &amp;&amp;</span>
            mockSerial.SetCommTimeouts(INVALID_HANDLE_VALUE, &amp;timeouts);
<span style = "background-color:#dfd">    }</span>
};

// Òåñòóâàííÿ ç ìîêîì
<span style = "background-color:#dfd">TEST_F(SerialCommunicationTest, TestConnectWithMock) {</span>
    // Ï³äêëþ÷àºìî ç âèêîðèñòàííÿì ìîêó
<span style = "background-color:#dfd">    bool result = connectWithMock("COM6", 9600);
    EXPECT_TRUE(result);  // Ïåðåâ³ðÿºìî, ùî ï³äêëþ÷åííÿ óñï³øíå
}</span>

<span style = "background-color:#dfd">int main(int argc, char** argv) {
    ::testing::InitGoogleTest(&amp;argc, argv);
    return RUN_ALL_TESTS();
}</span></pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>